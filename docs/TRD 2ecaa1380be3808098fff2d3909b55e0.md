# TRD

# Table Connect - 기술 요구사항 정의서 (TRD)

**버전:** v1.1 (Vercel + Supabase)

**작성일:** 2026년 1월 18일

**프로젝트명:** Table Connect

**참조 문서:** PRD v1.0

---

## 1. 시스템 아키텍처

### 1.1 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────┐
│                     사용자 (모바일)                      │
│                         PWA                              │
└───────────────┬─────────────────────────────────────────┘
                │ HTTPS
                ↓
┌───────────────────────────────────────────────────────────┐
│                   Vercel Platform                         │
│                                                           │
│  ┌────────────────────────────────────────────────────┐  │
│  │         Frontend (Next.js 14+)                     │  │
│  │         React + TypeScript + PWA                   │  │
│  └────────────────────────────────────────────────────┘  │
│                          │                                │
│                          ↓                                │
│  ┌────────────────────────────────────────────────────┐  │
│  │         Backend (Next.js API Routes)               │  │
│  │                                                    │  │
│  │  • /api/sessions/*  - 세션 관리                   │  │
│  │  • /api/messages/*  - 메시징                      │  │
│  │  • /api/gifts/*     - 선물                        │  │
│  │  • /api/admin/*     - 관리자                      │  │
│  │  • /api/payments/*  - 결제 (PG 연동)             │  │
│  │  • /api/filter/*    - AI 필터 (OpenAI)           │  │
│  └────────────────────────────────────────────────────┘  │
└───────────────┬───────────────────────────────────────────┘
                │
                ↓
┌───────────────────────────────────────────────────────────┐
│                   Supabase Platform                       │
│                                                           │
│  ┌──────────────────────┐    ┌────────────────────────┐  │
│  │ PostgreSQL Database  │    │ Realtime Server        │  │
│  │ - 가맹점/메뉴        │    │ - 실시간 메시징        │  │
│  │ - 세션 (짧은 TTL)    │    │ - 선물 알림            │  │
│  │ - 선물 거래          │    │ - 온라인 상태          │  │
│  │ - 정산 기록          │    │                        │  │
│  └──────────────────────┘    └────────────────────────┘  │
│                                                           │
│  ┌──────────────────────┐    ┌────────────────────────┐  │
│  │ Authentication       │    │ Storage (Optional)     │  │
│  │ - 관리자 로그인      │    │ - 이미지/파일          │  │
│  │ - Row Level Security │    │                        │  │
│  └──────────────────────┘    └────────────────────────┘  │
└───────────────────────────────────────────────────────────┘

```

### 1.2 데이터 흐름

**사용자 플로우:**

```
QR 스캔 → Frontend → POST /api/sessions/create
         → Supabase: 세션 생성 (sessions 테이블)
         → Frontend: 세션 토큰 반환 (쿠키)

```

**메시징 플로우 (실시간):**

```
메시지 전송 → POST /api/messages/send
           → AI 필터 검사 (OpenAI)
           → 통과 시 Supabase에 저장
           → Supabase Realtime이 자동으로 수신자에게 전송
           → Frontend가 실시간 수신

```

**선물 플로우:**

```
선물 선택 → POST /api/gifts/send
         → PG 결제 요청 (Stripe)
         → 결제 완료 → Supabase gifts 테이블 저장
         → Realtime으로 수신자에게 알림

```

---

## 2. 기술 스택

### 2.1 프론트엔드

### 선택 기술

- **프레임워크:** Next.js 14+ (App Router)
- **언어:** TypeScript 5+
- **스타일링:** Tailwind CSS 3+
- **상태 관리:** Zustand (경량) + React Context
- **실시간 통신:** Supabase Realtime Client
- **PWA:** next-pwa
- **폼 검증:** Zod

### 선택 이유

- **Next.js App Router:** 최신 React 서버 컴포넌트, Vercel 최적화
- **TypeScript:** 타입 안정성, AI 코딩 도구 지원 우수
- **Tailwind:** 빠른 스타일링, 다크 모드 기본 지원
- **Supabase Client:** WebSocket 복잡도 제거, 실시간 쉽게 구현
- **Zustand:** Redux보다 가볍고 간단

### 주요 라이브러리

```json
{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.2.0",
    "typescript": "^5.0.0",
    "@supabase/supabase-js": "^2.38.0",
    "@supabase/auth-helpers-nextjs": "^0.8.0",
    "zustand": "^4.4.0",
    "zod": "^3.22.0",
    "tailwindcss": "^3.3.0",
    "next-pwa": "^5.6.0",
    "react-hot-toast": "^2.4.1"
  }
}

```

### 대안

- **SvelteKit:** 더 가볍지만 생태계 작음
- **Remix:** SSR 강력하나 Vercel 최적화 약함

### 벤더 락인 리스크

- **낮음:** React/Next.js는 표준 기술
- **Vercel 의존:** 다른 호스팅(Netlify, Cloudflare)으로 이동 가능

---

### 2.2 백엔드

### 선택 기술

- **프레임워크:** Next.js API Routes (Serverless Functions)
- **언어:** TypeScript
- **실시간:** Supabase Realtime (자동 제공)
- **세션 관리:** Supabase Auth + Custom Session Logic
- **인메모리 캐시:** Vercel Edge Config (선택적)

### 선택 이유

- **Next.js API Routes:**
    - Frontend와 같은 코드베이스
    - Vercel에서 자동 배포
    - Serverless로 자동 확장
    - 별도 서버 관리 불필요
- **Supabase Realtime:**
    - WebSocket 서버 직접 구축 불필요
    - PostgreSQL Changes를 실시간으로 전송
    - 클라이언트 SDK 제공

### API 구조 예시

```tsx
// app/api/messages/send/route.ts
import { createClient } from '@supabase/supabase-js';
import { NextRequest, NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
  const supabase = createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.SUPABASE_SERVICE_ROLE_KEY!
  );

  const { receiver_id, content } = await request.json();

  // AI 필터링
  const filtered = await filterContent(content);
  if (filtered.blocked) {
    return NextResponse.json({ error: 'inappropriate' }, { status: 400 });
  }

  // DB 저장 (Realtime이 자동으로 수신자에게 전송)
  const { data, error } = await supabase
    .from('messages')
    .insert({ receiver_session_id: receiver_id, content });

  return NextResponse.json({ success: true, data });
}

```

### 대안

- **Express.js + Railway:** 전통적 서버, 더 많은 컨트롤
- **Fastify:** Express보다 빠름

### 벤더 락인 리스크

- **낮음:** API Routes는 표준 Node.js, 다른 플랫폼으로 이식 가능
- **Serverless 제약:**
    - 함수 실행 시간 최대 10초 (Vercel Hobby)
    - 장기 연결 불가 → Supabase Realtime이 대체

---

### 2.3 데이터베이스

### 선택 기술

- **주 데이터베이스:** Supabase PostgreSQL 15+
- **ORM:** Supabase Client (내장) + Prisma (선택적)
- **실시간:** Supabase Realtime
- **인증:** Supabase Auth (관리자용)

### 선택 이유

- **Supabase PostgreSQL:**
    - 무료 티어 관대 (500MB DB, 2GB 대역폭)
    - 자동 백업
    - 실시간 기능 내장
    - Row Level Security (RLS)로 보안 강화
- **Supabase Realtime:**
    - PostgreSQL의 변경사항을 실시간 구독
    - WebSocket 서버 불필요
    - 클라이언트에서 직접 구독 가능

### 데이터 접근 패턴

```tsx
// 클라이언트에서 실시간 구독
const supabase = createClient(url, anonKey);

// 새 메시지 실시간 수신
supabase
  .channel('messages')
  .on('postgres_changes',
    {
      event: 'INSERT',
      schema: 'public',
      table: 'messages',
      filter: `receiver_session_id=eq.${mySessionId}`
    },
    (payload) => {
      console.log('New message:', payload.new);
      addMessageToUI(payload.new);
    }
  )
  .subscribe();

```

### Row Level Security (RLS) 예시

```sql
-- 사용자는 자신이 보낸/받은 메시지만 조회 가능
CREATE POLICY "Users can only see their messages"
ON messages FOR SELECT
USING (
  sender_session_id = auth.uid()
  OR receiver_session_id = auth.uid()
);

```

### 대안

- **Vercel Postgres:** Neon 기반, 더 비쌈 ($20/월~)
- **PlanetScale:** MySQL, Serverless DB
- **Neon:** Serverless Postgres, Supabase와 유사

### 벤더 락인 리스크

- **중간:** Supabase 특화 기능(Realtime, RLS)에 의존
- **완화:** PostgreSQL 표준이므로 데이터 마이그레이션 가능
- **Supabase 없이 전환:** Realtime → [Socket.io](http://socket.io/), Auth → NextAuth로 대체

---

### 2.4 배포 및 호스팅

### 선택 기술

- **All-in-One:** Vercel
    - Frontend 호스팅
    - API Routes 실행 (Serverless Functions)
    - Edge Network (CDN)
    - 자동 HTTPS/도메인
- **데이터베이스:** Supabase
    - PostgreSQL 호스팅
    - 실시간 서버
    - 인증 서버

### 선택 이유

- **Vercel:**
    - Next.js 최적화 (동일한 회사 제품)
    - GitHub Push → 자동 배포
    - 일본 엣지 서버 자동 활용
    - Preview 배포 (PR마다 테스트 URL)
    - 무료 티어:
        - 100GB 대역폭
        - 서버리스 함수 100GB-시간
        - Edge Functions 500만 실행
- **Supabase:**
    - 무료 티어:
        - 500MB DB
        - 2GB 대역폭
        - 실시간 동시 연결 200개
        - 50MB 파일 스토리지
    - 자동 백업 (7일)
    - 자동 SSL
    - 일본 리전 선택 가능 (도쿄)

### 예상 비용

**Phase 1 (0-3개월, ~500명 사용자):**

- Vercel: $0 (무료 티어)
- Supabase: $0 (무료 티어)
- OpenAI API: ~$10/월 (AI 필터)
- Stripe: 거래 수수료만
- **총 월 비용: ~$10**

**Phase 2 (500-5000명 사용자):**

- Vercel Pro: $20/월
- Supabase Pro: $25/월
- OpenAI API: ~$30/월
- **총 월 비용: ~$75**

**Phase 3 (5000명+ 사용자):**

- Vercel Enterprise: 별도 협의
- Supabase Team: $599/월
- **총 월 비용: ~$700+**

### 확장 전략

- **동시 접속 200명 초과:** Supabase Pro 전환 (동시 연결 제한 해제)
- **API 함수 실행 초과:** Vercel Pro 전환
- **DB 500MB 초과:** Supabase Pro (8GB까지)
- **극단적 확장:** AWS RDS + ElastiCache로 마이그레이션

### 벤더 락인 리스크

- **중간:** Vercel + Supabase 조합에 최적화
- **완화 전략:**
    - Docker 컨테이너화 (백업)
    - DB 정기 백업 (pg_dump)
    - 코드는 표준 Next.js → 다른 호스팅 가능

---

### 2.5 외부 API 및 서비스

### 필수 연동

| 서비스 | 용도 | 비용 | 대체 옵션 |
| --- | --- | --- | --- |
| OpenAI Moderation API | 부적절 언어 필터링 | ~$10/월 | Perspective API (Google) |
| Stripe | 결제 처리 | 3.6% 거래 수수료 | [PAY.JP](http://pay.jp/), GMO Payment |
| i18next | 다국어 지원 | 무료 | react-intl |
| Vercel Analytics | 사용자 분석 (선택) | $10/월 | Google Analytics 4 |

### 선택적 연동 (Phase 2+)

- **Sentry:** 에러 추적 ($26/월)
- **SendGrid:** 이메일 발송 (가맹점 정산 알림)
- **Vercel Cron Jobs:** 스케줄 작업 (세션 정리)

---

## 3. 비기능적 요구사항

### 3.1 성능 요구사항

| 지표 | 목표 | 측정 방법 |
| --- | --- | --- |
| 페이지 로드 (FCP) | < 1.5초 | Vercel Analytics |
| API 응답 (P95) | < 500ms | Vercel 대시보드 |
| 메시지 전송 지연 | < 1초 | Supabase Realtime 자동 |
| DB 쿼리 | < 100ms | Supabase Dashboard |
| 동시 접속자 | 200명 (무료), 무제한 (Pro) | Supabase Realtime |

**최적화 전략:**

- **Vercel Edge Functions:** 정적 컨텐츠는 엣지에서 제공 (일본 서버)
- **Supabase Connection Pooling:** DB 연결 재사용
- **Incremental Static Regeneration (ISR):** 자주 변하지 않는 페이지 캐싱
- **Image Optimization:** next/image 자동 최적화
- **Code Splitting:** 자동 (Next.js)

---

### 3.2 보안 요구사항

### 인증 및 인가

- **Anonymous Users (세션):**
    - UUID 기반 세션 토큰
    - HttpOnly 쿠키 (XSS 방지)
    - SameSite=Strict (CSRF 방지)
    - 2시간 idle timeout
- **Merchant Admin:**
    - Supabase Auth (이메일/비밀번호)
    - JWT 토큰
    - Row Level Security (RLS)로 데이터 격리

### Row Level Security (RLS) 정책

```sql
-- 가맹점 관리자는 자기 매장 데이터만 접근
CREATE POLICY "Merchants can only access their own data"
ON merchants FOR ALL
USING (auth.uid() = admin_user_id);

-- 세션은 같은 매장 내에서만 서로 볼 수 있음
CREATE POLICY "Sessions can see other sessions in same merchant"
ON sessions FOR SELECT
USING (merchant_id = (
  SELECT merchant_id FROM sessions WHERE id = auth.uid()
));

```

### 데이터 보호

- **전송 중:** HTTPS (Vercel/Supabase 자동)
- **저장 시:**
    - 비밀번호: bcrypt (Supabase Auth 자동)
    - 결제 정보: 저장 안 함 (PG사 위임)
    - 세션 해시: SHA-256 (신고 로그용)

### 입력 검증

- **Frontend:** Zod 스키마

```tsx
import { z } from 'zod';

const MessageSchema = z.object({
  content: z.string().min(1).max(200),
  receiver_id: z.string().uuid()
});

```

- **Backend:** API Route에서 재검증

```tsx
export async function POST(req: NextRequest) {
  const body = await req.json();
  const result = MessageSchema.safeParse(body);
  if (!result.success) {
    return NextResponse.json({ error: 'Invalid input' }, { status: 400 });
  }
  // 처리...
}

```

### AI 필터링 (OpenAI Moderation)

```tsx
// app/lib/filter.ts
import OpenAI from 'openai';

const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });

export async function filterContent(text: string) {
  const moderation = await openai.moderations.create({ input: text });
  const result = moderation.results[0];

  return {
    blocked: result.flagged,
    categories: result.categories,
    scores: result.category_scores
  };
}

```

**필터링 카테고리:**

- sexual (성적 표현)
- hate (혐오 발언)
- violence (폭력)
- self-harm (자해)
- harassment (괴롭힘)

### 환경 변수 관리

```bash
# .env.local (개발)
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxx...
SUPABASE_SERVICE_ROLE_KEY=eyJxxx... # 백엔드 전용
OPENAI_API_KEY=sk-xxx...
STRIPE_SECRET_KEY=sk_test_xxx...

# Vercel (프로덕션)
Environment Variables 메뉴에서 설정

```

---

### 3.3 확장성 요구사항

### 수평 확장 전략

**현재 (0-200명 동시 접속):**

- Vercel Serverless Functions 자동 확장
- Supabase 무료 티어

**Phase 2 (200-2000명):**

- Supabase Pro ($25/월)
    - Connection Pooler 활성화
    - 동시 연결 무제한
- Vercel Pro ($20/월)
    - 함수 실행 제한 확대

**Phase 3 (2000명+):**

- Supabase Team ($599/월)
    - 8-64GB RAM
    - 전용 IP
- Vercel Enterprise
    - SLA 보장
    - 우선 지원

### 데이터베이스 확장

- **인덱싱:**

```sql
CREATE INDEX idx_sessions_merchant_active
ON sessions(merchant_id, is_active)
WHERE is_active = true;

CREATE INDEX idx_messages_receiver
ON messages(receiver_session_id, created_at DESC);

CREATE INDEX idx_gifts_merchant_date
ON gifts(merchant_id, created_at DESC);

```

- **파티셔닝 (Phase 3):**
    - 정산 테이블은 월별 파티션

```sql
  CREATE TABLE settlements_2026_01 PARTITION OF settlements
  FOR VALUES FROM ('2026-01-01') TO ('2026-02-01');

```

- **Read Replicas (Phase 3):**
    - Supabase에서 읽기 전용 복제본 추가
    - 정산 조회는 복제본에서

---

### 3.4 가용성 요구사항

| 지표 | 목표 | 제공 주체 |
| --- | --- | --- |
| 서비스 가동률 (Uptime) | 99.9% | Vercel + Supabase |
| DB 백업 주기 | 일 1회 자동 | Supabase (7일 보관) |
| 복구 시간 (RTO) | < 5분 | Vercel (자동 롤백) |
| 복구 시점 (RPO) | < 5분 | Supabase (PITR) |

**모니터링:**

- **Vercel:**
    - 자동 헬스체크
    - 빌드 실패 시 이메일 알림
    - Real-time logs
- **Supabase:**
    - DB 메트릭 대시보드
    - Slow query 자동 감지
    - 연결 풀 모니터링

**알림 설정:**

```tsx
// Vercel Cron Job으로 헬스체크
// vercel.json
{
  "crons": [{
    "path": "/api/health",
    "schedule": "*/5 * * * *"
  }]
}

```

---

## 4. 데이터베이스 설계

### 4.1 Supabase 스키마 설계 원칙

- **PostgreSQL 표준** 준수
- **Row Level Security (RLS)** 적극 활용
- **Realtime** 활성화 (messages, gifts 테이블)
- **타임스탬프:** created_at, updated_at (Supabase 자동)
- **Soft Delete:** deleted_at 컬럼 추가

### 4.2 주요 테이블

상세 스키마는 `DATABASE_DESIGN.md` 참조

**핵심 엔티티:**

```sql
-- Supabase에서 생성할 테이블들
CREATE TABLE merchants (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  admin_user_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  merchant_id UUID REFERENCES merchants(id),
  profile JSONB NOT NULL, -- {gender, age_range, party_size, nickname}
  is_active BOOLEAN DEFAULT true,
  expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Realtime 활성화
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
ALTER PUBLICATION supabase_realtime ADD TABLE gifts;

```

### 4.3 Realtime 구독 설정

```tsx
// 클라이언트에서 실시간 메시지 수신
const messagesChannel = supabase
  .channel('public:messages')
  .on(
    'postgres_changes',
    {
      event: 'INSERT',
      schema: 'public',
      table: 'messages',
      filter: `receiver_session_id=eq.${sessionId}`
    },
    (payload) => handleNewMessage(payload.new)
  )
  .subscribe();

```

---

## 5. API 설계

### 5.1 Next.js API Routes 구조

```
app/
├── api/
│   ├── sessions/
│   │   ├── create/route.ts      # POST - 세션 생성
│   │   ├── active/route.ts      # GET - 활성 세션 목록
│   │   └── leave/route.ts       # POST - 세션 종료
│   ├── messages/
│   │   ├── send/route.ts        # POST - 메시지 전송
│   │   └── block/route.ts       # POST - 차단
│   ├── gifts/
│   │   ├── send/route.ts        # POST - 선물 전송
│   │   └── received/route.ts    # GET - 받은 선물
│   ├── admin/
│   │   ├── auth/route.ts        # POST - 관리자 로그인
│   │   ├── menus/route.ts       # GET/POST/PUT/DELETE
│   │   └── settlements/route.ts # GET - 정산 조회
│   └── health/route.ts          # GET - 헬스체크

```

### 5.2 API 예시

```tsx
// app/api/sessions/create/route.ts
import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';
import { cookies } from 'next/headers';
import { NextRequest, NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
  const supabase = createRouteHandlerClient({ cookies });
  const { merchant_id, profile } = await request.json();

  // 세션 생성
  const { data: session, error } = await supabase
    .from('sessions')
    .insert({
      merchant_id,
      profile,
      expires_at: new Date(Date.now() + 2 * 60 * 60 * 1000) // 2시간
    })
    .select()
    .single();

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 });
  }

  // 쿠키에 세션 토큰 설정
  cookies().set('session_token', session.id, {
    httpOnly: true,
    secure: process.env.NODE_ENV === 'production',
    sameSite: 'strict',
    maxAge: 2 * 60 * 60
  });

  return NextResponse.json({ session });
}

```

---

## 6. 배포 파이프라인

### 6.1 자동 배포 흐름

```
GitHub Push (main 브랜치)
  ↓
Vercel 자동 감지
  ├── Install Dependencies (npm install)
  ├── TypeScript Type Check
  ├── Build Next.js (npm run build)
  ├── Run Tests (optional)
  └── Deploy to Production
      ├── Edge Functions 배포
      ├── Serverless Functions 배포
      ├── Static Assets → CDN
      └── Environment Variables 주입

Supabase 마이그레이션 (선택)
  └── Supabase CLI로 수동 또는 GitHub Actions

```

### 6.2 환경 분리

- **Development:** localhost + Supabase 로컬 인스턴스
- **Preview:** Vercel Preview Deployment (PR마다 자동)
- **Production:** [tableconnect.jp](http://tableconnect.jp/)

### 6.3 롤백 전략

- **Vercel:**
    - 이전 배포로 원클릭 롤백
    - 또는 Git Revert → Auto Deploy
- **Supabase DB:**
    - Point-in-Time Recovery (Pro)
    - 또는 마이그레이션 롤백 스크립트

---

## 7. 테스트 전략

### 7.1 테스트 레벨

| 레벨 | 도구 | 커버리지 |
| --- | --- | --- |
| Unit Test | Jest + React Testing Library | 70%+ |
| Integration | Supabase Test Client | 주요 API |
| E2E | Playwright | 핵심 플로우 3개 |
| Load Test | k6 | 500 동시 사용자 |

### 7.2 Supabase 테스트

```tsx
// tests/sessions.test.ts
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  process.env.SUPABASE_TEST_URL!,
  process.env.SUPABASE_TEST_KEY!
);

describe('Session Creation', () => {
  it('should create a session', async () => {
    const { data, error } = await supabase
      .from('sessions')
      .insert({ merchant_id: 'xxx', profile: {...} })
      .select()
      .single();

    expect(error).toBeNull();
    expect(data.id).toBeDefined();
  });
});

```

---

## 8. 운영 및 모니터링

### 8.1 Vercel Analytics

```tsx
// app/layout.tsx
import { Analytics } from '@vercel/analytics/react';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Analytics />
      </body>
    </html>
  );
}

```

### 8.2 Supabase Logging

```tsx
// API Route에서 Supabase 에러 로깅
try {
  const { data, error } = await supabase.from('messages').insert(...);
  if (error) throw error;
} catch (error) {
  console.error('Supabase Error:', {
    code: error.code,
    message: error.message,
    details: error.details
  });
}

```

### 8.3 알림

- **Vercel:** 빌드 실패, 배포 완료 → 이메일
- **Supabase:** DB 사용량 80% → 이메일
- **Custom:** Vercel Cron으로 일일 리포트 전송

---

## 9. 기술 부채 및 향후 개선

### 9.1 알려진 제약사항

- **Supabase 무료 티어:**
    - 500MB DB → Phase 2에서 Pro 전환
    - 동시 연결 200개 → Pro는 무제한
- **Vercel Serverless 제약:**
    - 10초 타임아웃 → 대부분 문제없음
    - 장기 WebSocket 불가 → Supabase Realtime이 대체

### 9.2 개선 로드맵

- **Phase 2:**
    - Vercel Edge Middleware (인증 최적화)
    - Supabase Storage (프로필 이미지)
    - Vercel Cron (자동화)
- **Phase 3:**
    - GraphQL API (Supabase 내장 지원)
    - Supabase Functions (서버사이드 로직)
    - AI 추천 시스템

---

## 10. 부록

### 10.1 개발 환경 설정

```bash
# 1. 프로젝트 클론
git clone <https://github.com/your-repo/table-connect.git>
cd table-connect

# 2. 의존성 설치
npm install

# 3. Supabase 로컬 시작 (선택)
npx supabase start

# 4. 환경 변수 설정
cp .env.example .env.local
# .env.local에 Supabase URL/KEY 입력

# 5. 개발 서버 실행
npm run dev

```

### 10.2 Supabase CLI 명령어

```bash
# 마이그레이션 생성
npx supabase migration new create_sessions_table

# 마이그레이션 적용
npx supabase db push

# 타입 생성 (TypeScript)
npx supabase gen types typescript --project-id xxx > types/supabase.ts

```

### 10.3 Vercel 배포

```bash
# Vercel CLI 설치
npm i -g vercel

# 로그인
vercel login

# 배포
vercel

# 프로덕션 배포
vercel --prod

```

---

**문서 버전 이력:**

- v1.0 (2026-01-18): 초안 (Railway)
- v1.1 (2026-01-18): Vercel + Supabase 올인원 (현재)